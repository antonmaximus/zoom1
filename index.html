<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1">

<title>MEOW</title>
<style>

p { font-size: 60px;}


#blue {
    border: 1px solid blue;
}


body, div, img {
    padding: 0;
    margin: 0;
}

body {
    background-color: white;
    border: 2px solid red;
    }

#wrapper {
    border: 2px solid yellow;
    position: relative;
/*    height: 100vh;
    width: 100vw;*/
}

#targetImg {
    position: relative;
    top: 0;
    left: 0;
    width: 100%;
}

</style>
</head>

<body>

<div id='green'>
    <p id='green1'>111 qq </p>
    <p id='green2'>hellow aa </p>
</div>


<div id='wrapper' >
    <img id='targetImg' src="Travel_MoneyTips.png" alt="" />
    <!-- <img id='targetImg' src="http://2.bp.blogspot.com/-VQJMK8PRnI0/UjYaglEkV5I/AAAAAAAAACg/N2MkW6iorr0/s1600/30192_1600x1200-4-cute-cats.jpg" /> -->
</div>

<!-- <div id='blue'>
    <p id='viewportP'>111 qq </p>
    <p id='widthImg'>hellow aa </p>
    <p id='lefpos'>hellow aa </p>
</div>
 -->

<script src="./hammer.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


<script type="text/javascript">

var wrapper = document.getElementById('wrapper'), 
    targetImg = document.getElementById('targetImg');
var thisBody = document.body;

var viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
var viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);


var hammertime = new Hammer(wrapper);

hammertime.get('pinch').set({ enable: true }); //Pinch is disabled by default

// Items below are enabled by default
// hammertime.get('pan').set({ enable: false });  
// hammertime.get('tap').set({ enable: false });
hammertime.get('press').set({ enable: false });
hammertime.get('rotate').set({ enable: false });
hammertime.get('swipe').set({ enable: false });


// Event Listeners
hammertime.on('pan', panImage);
hammertime.on('pinch', resize);
hammertime.on('doubletap', showFull);

jQuery('#green').hide();
// Hammer(document.getElementById('green')).on('tap', function(e) {
//     // var imgWidth = parseInt(getComputedStyle(wrapper).width);
//     var imgHeight = parseInt(getComputedStyle(wrapper).height);
// var viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
// var viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

//      var   frameWidth = window.frameElement.offsetWidth || Math.max(document.documentElement.clientWidth, window.innerWidth || 0), 
//         frameHeight = window.frameElement.offsetHeight|| Math.max(document.documentElement.clientWidth, window.innerHeight || 0);


//     jQuery('#green1').html('1vH ' + frameHeight + ' vw: ' + frameWidth);
//     jQuery('#green2').html(imgHeight);
// });

function showFull(e) {
    // Set everything to default
    thisBody.style.width = '100%'
    wrapper.style.width = '100%';

    targetImg.style.top = '0';
    targetImg.style.left = '0';
}


/* 'panImage' will modify left and top positions to appear that the user is scrolling on the 
/* image.  We use this approach because default scrolling will not work correctly
/* due to Hammer.js */
function panImage (e) {

    // These variables need to be local since orientation can change.
    var imgWidth = parseInt(getComputedStyle(wrapper).width),
        imgHeight = parseInt(getComputedStyle(wrapper).height),
        // frameWidth & frameHeight: Use parent iframe's size by default.  Use viewport's size as fallback.
        frameWidth = /*window.frameElement.offsetWidth ||*/ Math.max(document.documentElement.clientWidth, window.innerWidth || 0), 
        frameHeight = /*window.frameElement.offsetHeight||*/ Math.max(document.documentElement.clientWidth, window.innerHeight || 0);



    // Configure Horizontal Pan
    var minLeft = 0,
        maxLeft = frameWidth - imgWidth,
        posLeft = parseInt(getComputedStyle(targetImg).left),
        newLeft  =  posLeft + e.deltaX;

    if(imgWidth < frameWidth || newLeft > minLeft) {
        newLeft = minLeft ;
    } else if (newLeft < maxLeft) {
        newLeft = maxLeft;
    }
    targetImg.style.left = newLeft + 'px';


    // Configure Vertical Pan
    var minTop = 0,
        maxTop = frameHeight - imgHeight,
        posTop = parseInt(getComputedStyle(targetImg).top),
        newTop  =  posTop + e.deltaY;

    if(imgHeight < frameHeight || newTop > minTop) {
        newTop = minTop ;
    } else if (newTop < maxTop) {
        newTop = maxTop;
    }
    targetImg.style.top = newTop + 'px';

}


function resize (e) {
    // These variables need to be local due to orientation changing
    var imgWidth = parseInt(getComputedStyle(wrapper).width),
        imgHeight = parseInt(getComputedStyle(wrapper).height),
        viewportWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0),
        viewportHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

    // Save ratio for keeping position intact
    var ratioLeft = parseInt(getComputedStyle(targetImg).left) / imgWidth,
        ratioTop = parseInt(getComputedStyle(targetImg).top) / imgHeight;   


    var delta = Math.sqrt( (e.deltaY * e.deltaY) + (e.deltaX * e.deltaX) ); // Calculus formula
    var newWidth = imgWidth - delta;

    var minZoom = viewportWidth;
    var maxZoom = viewportWidth * 2.5;

    if( newWidth < minZoom) {
        newWidth = minZoom;
    } else if (newWidth > maxZoom) {
        newWidth = maxZoom;
    }

    wrapper.style.width = newWidth + 'px';
    thisBody.style.width = newWidth + 'px';


    /* Now reposition top and left according to initial ratio. */
    var newHeight = newWidth * (imgHeight/imgWidth);  // This is the new height in theory.
    var newLeft = ratioLeft * newWidth,
        newTop = ratioTop * newHeight;

    targetImg.style.left = newLeft + 'px';
    targetImg.style.top = newTop + 'px';

    // jQuery('#viewportP').html('newLeft ' + newLeft);
    // jQuery('#widthImg').html('newTop ' + newTop);



    // //Corner case: Zooming-in and edge is revealed
    // var maxX = viewportWidth - imgWidth;
    // var posLeft = parseInt(getComputedStyle(targetImg).left);

    // if (posLeft < maxX) {
    //     posLeft = maxX;
    //     targetImg.style.left = posLeft + 'px';
    // }

    // jQuery('#viewportP').html('vW ' + viewportWidth);
    // jQuery('#widthImg').html('imgw ' + maxX);
    // jQuery('#lefpos').html('lefpos ' + posLeft);



    // //Corner case: Zooming-in and edge is revealed
    // var maxY = viewportHeight - imgHeight;
    // var posTop = parseInt(getComputedStyle(targetImg).top);

    // if (posTop < maxY) {
    //     posTop = maxY;
    //     targetImg.style.top = posTop + 'px';
    // }

    // jQuery('#viewportP').html('vH ' + viewportHeight);
    // jQuery('#widthImg').html('imgw ' + maxX);
    // jQuery('#lefpos').html('posTop ' + posTop);
};


// console.log('woo ohoo');
// var app = window.parent.app;

// console.log(app);

// if (app.environment.mobile) {
//     // implement zoom icons and functionality for mobile
//     app.util.embedFile(app.util.frontend_path('js/plugins', 'hammer.min.js'), function () {
        
//         Hammer(container, {
//             drag_block_vertical: true,
//             drag_block_horizontal: true
//         })
//         .on("swipeleft", rpLib.scope(self.swipeLeft, self))
//         .on("swiperight", rpLib.scope(self.swipeRight, self));
//     });

// } else {
    
// }

</script>




</body>

</html>